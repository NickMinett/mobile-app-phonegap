angular.module("joy-global",["config","ui.router","satellizer","ngStorage","angularMoment","ngSanitize","underscore","templates","restangular"]),angular.module("joy-global").config(["$urlRouterProvider","$locationProvider","$authProvider","ENV","RestangularProvider","DeviceReadyProvider",function(e,n,t,o,r,i){r.setBaseUrl(o.apiEndpoint),t.loginUrl=o.apiEndpoint+"auth/authenticate",e.otherwise("/")}]),angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"https://seng3150-api.wingmanwebdesign.com.au/"}),angular.module("joy-global").controller("AuthControllerLogin",["$scope","AuthService","$state","$stateParams","$window",function(e,n,t,o,r){var i={clear:function(){},info:function(){},warning:function(){},error:function(){},success:function(){}};e.username="",e.password="",e.type="technician",n.getUser()&&(e.username=n.getUser().primary.username,e.type=n.getUser().type),e.login=function(){if(1==e.validate()){i.info("Attempting to login.");var a={username:e.username,password:e.password,type:e.type};n.authenticate(a).then(function(e){i.clear(),i.success("Welcome to Joy Global."),o.r?r.location.href=o.r:t.go("index")},function(){i.clear(),i.error("Your credentials were incorrect.","Error")},function(){i.clear(),i.info("Loading your account information now...","You were logged in successfully.")})}return!1},e.validate=function(){return""==e.username||null==e.username?(i.clear(),i.error("You must provide your Username.","Error"),!1):""!=e.password||(i.clear(),i.warning("You must provide your Password.","Error"),!1)}}]),angular.module("joy-global").controller("AuthControllerLogout",["$auth","$state",function(e,n){e.logout().then(function(){n.go("auth.login")})}]),angular.module("joy-global").controller("TechnicianIndexControllerIndex",["$scope",function(e){}]),angular.module("joy-global").controller("TechnicianInspectionsControllerIndex",["$scope","Inspections","moment",function(e,n,t){e.loading=!0,n.getList({include:"machine.model,technician,scheduler"}).then(function(n){e.loading=!1,e.inspections=n}),e.moment=t}]),angular.module("joy-global").controller("TechnicianInspectionsControllerView",["$scope","Inspections","moment","$stateParams",function(e,n,t,o){e.inspectionId=o.id,e.loading=!0,e.moment=t,n.one(e.inspectionId).get({include:"technician,scheduler,machine.model,majorAssemblies.majorAssembly,majorAssemblies.subAssemblies.subAssembly"}).then(function(n){e.loading=!1,e.inspection=n})}]),angular.module("joy-global").factory("Inspections",["APIService",function(e){var n=e.service("inspections");return n.getBulk=function(){return e.service("inspections/bulk")},n}]),angular.module("joy-global").provider("DeviceReady",[function(){this.onReady=function(e){"object"==typeof window.cordova?document.addEventListener("deviceready",e,!1):e()},this.$get=[function(){}]}]),angular.module("joy-global").config(["$stateProvider",function(e){e.state("auth",{"abstract":!0,url:"/auth",templateUrl:"views/layouts/plain.html",data:{specialClass:"gray-bg"}}).state("auth.login",{parent:"auth",url:"/login?r",templateUrl:"views/auth/login.html",controller:"AuthControllerLogin"}).state("auth.logout",{parent:"auth",url:"/logout",controller:"AuthControllerLogout"})}]),angular.module("joy-global").config(["$stateProvider",function(e){e.state("index",{url:"/",controller:["$state","AuthService",function(e,n){null!=n.getUser()&&null!=n.getUser().type?e.go(n.getUser().type+"-index"):e.go("auth.login")}],resolve:{loggedIn:["AuthService",function(e){return e.checkPermissions(!0)}]}}).state("technician",{"abstract":!0,url:"/technician",templateUrl:"views/layouts/default.html",resolve:{loggedIn:["AuthService",function(e){return e.checkPermissions(!0)}]}})}]).run(["$rootScope","$state","$auth","$window",function(e,n,t,o){e.$on("$stateChangeError",function(e){e.preventDefault(),n.go("auth.login",{r:o.location.href})}),e.$state=n}]),angular.module("joy-global").config(["$stateProvider",function(e){e.state("technician-index",{parent:"technician",url:"/",templateUrl:"views/technician/index/index.html",controller:"TechnicianIndexControllerIndex",resolve:{loggedIn:["AuthService",function(e){return e.checkPermissions(!0)}]}})}]),angular.module("joy-global").config(["$stateProvider",function(e){e.state("technician-inspections-index",{parent:"technician",url:"/inspections",templateUrl:"views/technician/inspections/index.html",controller:"TechnicianInspectionsControllerIndex",resolve:{loggedIn:["AuthService",function(e){return e.checkPermissions(!0)}]}}).state("technician-inspections-view",{parent:"technician",url:"/inspections/:inspection",templateUrl:"views/technician/inspections/view.html",controller:"TechnicianInspectionsControllerView",resolve:{loggedIn:["AuthService",function(e){return e.checkPermissions(!0)}]}})}]),angular.module("joy-global").service("APIService",["Restangular",function(e){return{service:function(n){var t=e.service(n);return t.one=function(t){return e.one(n,t)},t}}}]),angular.module("joy-global").service("AuthService",["$auth","ENV","$localStorage","$q","$http",function(e,n,t,o,r){this.user=t.user,this.setUser=function(e){return this.user=e,t.user=e,this},this.getUser=function(){return this.user},this.authenticate=function(t){var i=this,a=o.defer();return e.login(t).then(function(){a.notify(),r.get(n.apiEndpoint+"auth/me").success(function(e){i.setUser(e),a.resolve(e)})},function(){a.reject()}),a.promise},this.checkPermissions=function(t){var i=this,a=o.defer();return 1==t&&0==e.isAuthenticated()?e.getToken()?r.get(n.apiEndpoint+"auth/refresh",{params:{token:e.getToken()}}).success(function(n){e.setToken(n.token),a.resolve()}).error(function(){i.setUser(null),a.reject()}):(i.setUser(null),a.reject()):a.resolve(),a.promise}}]);